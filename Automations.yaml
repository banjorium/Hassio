#https://community.home-assistant.io/t/logitech-harmony-integration-with-ianddays-component/6183/188

- id: 'Living Room Harmony'
  initial_state: on
  hide_entity: False
  trigger:
    platform: state
    entity_id: input_select.harmony1
    from: 'Select Input'
  action:
  - service: remote.turn_on
    entity_id: remote.harmonyhub
    data_template:
      activity: >
        {% if is_state("input_select.harmony1", "TV") %}
        31003729
        {% elif is_state("input_select.harmony1", "PS4") %}
        31004539
        {% else %}
        {% endif %}
  - service: input_select.select_option
    entity_id: input_select.harmony1
    data_template:
      option: "Select Input"

- id: 'Living Room Harmony Off'
  hide_entity: False
  initial_state: on
  trigger:
    platform: state
    entity_id: input_select.harmony1
    to: 'Power Off'
  action:
  - service: remote.turn_off
    entity_id: remote.harmonyhub
  - service: input_select.select_option
    entity_id: input_select.harmony1
    data_template:
      option: "Select Input"

- id: 'Master Bedroom Harmony'
  initial_state: on
  hide_entity: False
  trigger:
    platform: state
    entity_id: input_select.harmony2
    from: 'Select Input'
  action:
  - service: remote.turn_on
    entity_id: remote.harmonyhub2
    data_template:
      activity: >
        {% if is_state("input_select.harmony2", "TV") %}
        34237743
        {% else %}
        {% endif %}
  - service: input_select.select_option
    entity_id: input_select.harmony2
    data_template:
      option: "Select Input"

- id: 'Master Bedroom Harmony Off'
  hide_entity: False
  initial_state: on
  trigger:
    platform: state
    entity_id: input_select.harmony2
    to: 'Power Off'
  action:
  - service: remote.turn_off
    entity_id: remote.harmonyhub2
  - service: input_select.select_option
    entity_id: input_select.harmony2
    data_template:
      option: "Select Input"
      
- id: Daily snapshot at 2 AM
  initial_state: on
  trigger:
    platform: time
    at: '02:00:00'
  action:
  - service: hassio.snapshot_full
    data:
      name: automated backup {{ now().strftime('%Y-%m-%d') }}


- id: Daily upload to dropbox at 8AM
  initial_state: on
  trigger:
    platform: time
    at: '08:00:00'
  action:
  - service: hassio.addon_stdin
    data:
      addon: "7be23ff5_dropbox_sync"
      input: {"command":"upload"}

# Text JOR when Update Available for Hassio
- id: "Update_Update"
  initial_state: on
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    service: notify.notify
    data:
      message: "There is a new HASS update available"
      title: "HA Update Alert"
      
- id: Entry Light on with Motion
  initial_state: on
  trigger:
  - platform: state
    entity_id: binary_sensor.front_door_motion
  condition: 
    - condition: sun
      after: sunset
      before_offset: '1:00:00'
    - condition: state
      entity_id: light.entry
      state: 'off'
  action:
    - service: light.turn_on
      entity_id: light.entry
    - delay: '00:05:00'
    - service: light.turn_off
      entity_id: light.entry

- id: 'Turn on Entry Lights - Jor Home'
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.jor_home
    to: 'True'
  condition: 
    - condition: sun
      after: sunset
      before_offset: '1:30:00'
    - condition: state
      entity_id: light.entry
      state: 'off'
  action:
    - service: light.turn_on
      entity_id: light.entry
    - delay: '00:15:00'
    - service: light.turn_off
      entity_id: light.entry


- id: 'Turn on Entry Lights - Cella Home'
  initial_state: on
  trigger:
    platform: state
    entity_id: sensor.cella_home
    to: 'True'
  condition: 
    - condition: sun
      after: sunset
      before_offset: '1:30:00'
    - condition: state
      entity_id: light.entry
      state: 'off'
  action:
    - service: light.turn_on
      entity_id: light.entry
    - delay: '00:15:00'
    - service: light.turn_off
      entity_id: light.entry
      
#Another Solution:
#- id: Turn on kitchen light when movement
  #trigger:
   # platform: state
    #entity_id: binary_sensor.pir_hall
    #to: 'on'
  #condition:
  #- condition: state
  #  entity_id: light.kitchen
  #  state: 'off'
  #- condition: or
  #  conditions:
  #  - condition: sun
  #    after: sunset
#      after_offset: "-1:00:00"
#    - condition: sun
#      before: sunrise
#      before_offset: "1:00:00"
#  action:
#  - service: light.turn_on
#    data:
#      entity_id: light.kitchen

- id: Garage_Open_Alert
  initial_state: on
  trigger:
    - platform: state
      entity_id: cover.garage_left
      to: open
      for:
        minutes: '10'
  action:
    service: notify.notify
    data:
      message: "The left garage door has been open for 10 minutes"
      title: "Garage Open Alert"

#Close the Garage after 2 minutes of being open
- id: Garage_Open_Close
  trigger:
    - platform: state
      entity_id: cover.garage_left
      to: open
      for:
        minutes: '2'
  condition:
    - condition: state
      entity_id: 'sensor.jor_home'
      state: 'False'
  action:
    service: cover.close_cover
    entity_id: cover.garage_left
    
    
#Close the Garage after 15 minutes of being open if no motion in garage
- id: Garage_Open_NoMotion
  trigger:
    - platform: state
      entity_id: binary_sensor.garage_motion_motion
      to: 'off'
      for:
        minutes: '15'
  condition:
    - condition: state
      entity_id: cover.garage_left
      state: open
  action:
    service: cover.close_cover
    entity_id: cover.garage_left
    
#TEXT CELLA when JORDAN is LEAVING ELM
- id: jor_leaving_elm_st
  trigger:
    platform: zone
    entity_id: device_tracker.jphone
    event: leave
    zone: zone.elm_st
  action:
    service: ifttt.trigger
    data: {"event": "Jor_Leaving_Elm_St", "value1": "Hello World"}
    
#TEXT CELLA when JORDAN ARRIVES MILLYARD
- id: jor_arriving_millyard
  trigger:
    platform: zone
    entity_id: device_tracker.jphone
    event: enter
    zone: zone.millyard
  action:
    service: ifttt.trigger
    data: {"event":"jor_arriving_millyard", "value1": "Hello World"}
    
#TEXT JORDAN when CELLA is LEAVING MILLYARD
- id: cella_leaving_millyard
  trigger:
    platform: zone
    entity_id: device_tracker.cella_gpslogger
    event: leave
    zone: zone.millyard
  action:
    service: ifttt.trigger
    data: {"event":"cella_leaving_millyard", "value1": "Hello World"}

#TEXT CELLA When CELLA ARRIVES HOME
#- id: cella_arriving_home
#  trigger:
#    platform: zone
#    entity_id: device_tracker.cella_gpslogger
#    event: enter
#    zone: zone.home
#  action:
#    service: ifttt.trigger
#    data: {"event":"cella_arriving_home", "value1": "Hello World"}
    
#Trigger VDay Stuff
#- id: trigger_vday
#  trigger:
#    platform: zone
#    entity_id: device_tracker.cellaphone_cellaphone
#    event: enter
#    zone: zone.home
#  action:
#    service: homeassistant.turn_on
#    entity_id: scene.valentinesday
    
#- id: testing
#  trigger:
#    platform: time
#    # Matches every hour at 5 minutes past whole
#    minutes: /5
#    seconds: 00
#  action:
#    service: notify.notify
#    data:
#      message: "5 Minutes have passed since the last message!"
#      title: "It Lives!!!"

- id: 'Motion Kitchen - Turn on Lights - Daytime'
  initial_state: on
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor__motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '05:30:00'
      before: '22:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: switch.turn_on
      entity_id: switch.kitchen_lights
      
- id: 'Motion Kitchen - Turn on Lights - Daytime'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor__motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '05:30:00'
      before: '22:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: 
        - light.counter_right
      data:
        brightness: 254
        rgb_color: [255, 255, 255]
      
- id: 'Motion Kitchen - Turn on Lights - Night Time'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor__motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '23:00:00'
      before: '05:29:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: light.counter_right
      data:
        brightness: 150
        rgb_color: [255, 0, 0]
      
      
- id: Motion Detection - Kitchen Light off - Switch
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_motion
    to: 'off'
    for: '00:05:00'
  action:
   - service: switch.turn_off
     entity_id: switch.kitchen_lights

- id: Motion Detection - Kitchen Light off - Counter
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_motion
    to: 'off'
    for: '00:05:00'
  action:
   - service: light.turn_off
     entity_id: light.counter_right
     
- id: NO Motion Detection - Kitchen Light on - Counter
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_motion
    to: 'off'
    for: '00:05:02'
  condition:
    - condition: time
      after: '05:30:00'
      before: '23:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
   - service: light.turn_on
     entity_id: light.counter_right
     data:
       brightness: 200
       effect: random
       
       
      
    
- id: 'Basement Door Opens - Turn on Lights'
  initial_state: 'on'
  trigger:
      platform: state
      entity_id:
        - binary_sensor.basement_door_opened
      to: 'on'
      from: 'off'
  action:
      service: light.turn_on
      entity_id: 
        - light.basement_landing
        - light.gym
        - light.hydro_light
        - light.workshop_light
        - light.drums
      
- id: 'Basement Door Opens - Turn on Switches'
  initial_state: 'on'
  trigger:
      platform: state
      entity_id:
        - binary_sensor.basement_door_opened
      to: 'on'
      from: 'off'
  action:
      service: switch.turn_on
      entity_id: 
        - switch.workbench
        - switch.filter
        - switch.craft
      
- id: 'Motion Downstairs - Turn off with no motion and door closed'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor_2_motion
      to: 'off'
      for: '00:10:00'
  condition:
    - condition: state
      entity_id: binary_sensor.basement_door_opened
      state: 'off'
  action:
    - service: homeassistant.turn_off
      entity_id: group.downstairs_auto
      
- id: 'Mudroom Motion - Turn on Lights - Day Time'
  initial_state: 'on'
  trigger:
      platform: state
      entity_id:
        - binary_sensor.motion_sensor_3_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '05:30:00'
      before: '23:00:00'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
      service: light.turn_on
      entity_id: light.laundry_light
      data:
        brightness: 254
        
        
- id: 'Mudroom Motion - Turn on Lights - Night Time'
  initial_state: 'on'
  trigger:
      platform: state
      entity_id:
        - binary_sensor.motion_sensor_3_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '23:00:10'
      before: '05:29:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
      service: light.turn_on
      entity_id: light.laundry_light
      data:
        brightness: 45
      
- id: 'Motion Mudroom - Turn off with no motion'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor_3_motion
      to: 'off'
      for: '00:02:00'
  action:
    - service: light.turn_off
      entity_id: light.laundry_light

- id: 'Motion Master Bathroom - Turn on Lights - Daytime'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_8_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '06:55:00'
      before: '21:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: 
        - light.master_bath_toilet
        - light.master_bathroom_shower
      data:
        brightness: 254
      
      
- id: 'Motion Master Bathroom - Turn on Switch - Daytime'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_8_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '06:45:00'
      before: '21:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: switch.turn_on
      entity_id: 
        - switch.master_bathroom_fixture
        
- id: 'Motion Master Bathroom - Turn on Lights - Nighttime'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_8_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '22:00:00'
      before: '06:54:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: 
        - light.master_bath_toilet
        - light.master_bathroom_shower
      data:
        brightness: 40

- id: 'Motion Master Bathroom - Turn off with no motion - Night'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor_8_motion
      to: 'off'
      for: '00:01:30'
  condition:
    - condition: time
      after: '22:00:00'
      before: '06:54:59'
  action:
    - service: light.turn_off
      entity_id: 
        - light.master_bath_toilet
        - light.master_bathroom_shower

- id: 'Motion Master Bathroom - Turn off with no motion - DAY'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor_8_motion
      to: 'off'
      for: '00:15:00'
  condition:
    - condition: time
      after: '06:55:00'
      before: '21:59:59'
  action:
    - service: light.turn_off
      entity_id: 
        - light.master_bathroom_shower
        - light.master_bath_toilet

- id: 'Motion Master Bathroom - Turn off Switch with no motion - DAY'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor_8_motion
      to: 'off'
      for: '00:15:00'
  condition:
    - condition: time
      after: '06:45:00'
      before: '21:59:59'
  action:
    - service: switch.turn_off
      entity_id: 
        - switch.master_bathroom_fixture
        
        
- id: 'Motion Master Bedroom - Turn on Lights - Daytime - Normal Day'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_5_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '06:59:00'
      before: '21:59:59'
    - condition: time
      weekday:
        - tue
        - thu
        - fri
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: 
        - light.jors_side
        - light.cellas_side
      data:
        brightness: 254
        
        
- id: 'Motion Master Bedroom - Turn off with no motion'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor_5_motion
      to: 'off'
      for: '00:05:00'
  action:
    - service: light.turn_off
      entity_id: 
        - light.jors_side
        - light.cellas_side


- id: 'Motion Master Bedroom - Turn on Lights - Daytime - WFH Day'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_5_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '09:30:00'
      before: '21:59:59'
    - condition: time
      weekday:
        - mon
        - wed
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: 
        - light.jors_side
        - light.cellas_side
      data:
        brightness: 254
        
- id: 'Motion Master Bedroom - Turn on Lights - Daytime - Weekends'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_5_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '09:30:00'
      before: '21:59:59'
    - condition: time
      weekday:
        - sat
        - sun
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: 
        - light.jors_side
        - light.cellas_side
      data:
        brightness: 254

- id: 'Motion Guest Bathroom - Turn on Lights - Daytime'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_4_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '06:55:00'
      before: '21:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id:
        - light.bathroom
        - light.hallway_middle
      data:
        brightness: 254
        
- id: 'Motion Guest Bathroom - Turn on Switch - Daytime'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_4_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '06:55:00'
      before: '21:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: homeassistant.turn_on
      entity_id:
        - switch.guest_bathroom_fixture

- id: 'Motion Guest Bathroom - Turn on Lights - Day Time - Bloom'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_4_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '06:00:10'
      before: '21:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: light.bathroom
      data:
        brightness: 150
        rgb_color: [255, 255 , 255]
        
- id: 'Motion Guest Bathroom - Turn on Lights - Late Night Time - Bloom'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_4_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '22:00:00'
      before: '23:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: light.bathroom
      data:
        brightness: 75
        color_temp: 130
        rgb_color: [255, 255 , 255]
        

- id: 'Motion Guest Bathroom - Turn on Lights - Nighttime - Toilet'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_4_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '22:00:00'
      before: '06:54:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: light.hallway_middle
      data:
        brightness: 40

- id: 'Motion Guest Bathroom - Turn on Lights - Nighttime - Bloom'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_4_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '22:00:00'
      before: '06:00:00'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: light.bathroom
      data:
        brightness: 150
        rgb_color: [255, 0 ,0]

- id: 'Motion Guest Bathroom - Turn off with no motion'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor_4_motion
      to: 'off'
      for: '00:05:00'
  action:
    - service: homeassistant.turn_off
      entity_id: 
        - light.bathroom
        - switch.guest_bathroom_fixture
        - light.hallway_middle

- id: 'Motion Guest Bathroom - Turn on colors with no motion'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id:
        - binary_sensor.motion_sensor_4_motion
      to: 'off'
      for: '00:05:02'
  condition:
    - condition: time
      after: '06:00:00'
      before: '23:59:00'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id: 
        - light.bathroom
      data: 
        brightness: 254
        effect: random
        

#TURN ON LIGHTS when Anyone ARRIVE HOME
- id: Anyone_Arrive_HOME_TURNONIMHOME
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: sensor.everyone_home
    to: 'True'
  action:
    service: homeassistant.turn_on
    entity_id: group.imhome

#Open GARAGE When Jor Arrive Home
- id: JOR_Arrive_Home_Open_Garage
  trigger:
    - platform: state
      entity_id: sensor.jor_home
      to: 'True'
  action:
    service: cover.open_cover
    entity_id: cover.garage_left
    
    
#Close GARAGE When Jor Leaves Home
- id: JOR_Leave_Home_Close_Garage
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: sensor.jor_home
      to: 'False'
  action:
    service: cover.close_cover
    entity_id: cover.garage_left
    

- id: 'Turn on Garage Lights When Opened'
  initial_state: 'on'
  trigger: 
    - platform: state
      entity_id: cover.garage_left
      to: 'on'
      from: 'off'
  action:
    - service: switch.turn_on
      entity_id: switch.garage_lights
    - delay: '00:15:00'
    - service: switch.turn_off
      entity_id: switch.garage_lights
    
#- id: 'Turn on Garage Lights When Mudroom Door Opened'
#  initial_state: 'on'
#  trigger: 
#    - platform: state
#      entity_id: binary_sensor.mudroom_door_opened
#      to: 'on'
#      from: 'off'
#  action:
#    - service: switch.turn_on
#      entity_id: switch.garage_lights

- id: 'Turn off Garage Lights When No Motion Detected'
  initial_state: 'on'
  trigger: 
    - platform: state
      entity_id: binary_sensor.garage_motion_motion
      to: 'off'
      for: '00:09:00'
  action:
    - service: switch.turn_off
      entity_id: switch.garage_lights
      
- id: 'Turn on Garage Lights When No Motion Detected'
  initial_state: 'on'
  trigger: 
    - platform: state
      entity_id: binary_sensor.garage_motion_motion
      to: 'on'
      from: 'off'
  action:
    - service: switch.turn_on
      entity_id: switch.garage_lights
   

#Close GARAGE When Jor Leaves Home
#- id: JOR_Leave_Home_ Close_Garage
#  trigger:
#    - platform: state
#      entity_id: sensor.jor_not_home
#      from: 'off'
#      to: 'on'
#  action:
#    service: cover.close_cover
#    entity_id: cover.garage_left
    
    
# Close Garage if it has been open for more than an hour after dark.
#- id: CLOSE_Garage_AfterDark
#  trigger: 
#    - platform: state
#      entity_id: cover.garage_left
#      state: 'On'
#      for:
#        minutes: '60'
#  condition:
#    condition: sun
#    after: sunset
#    after_offset: "-0:15:00"
#  action:
#    service: cover.close_cover
#    entity_id: cover.garage_left
        
    
- id: 'Unlock when jor get home'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: sensor.jor_home
    to: 'True'
  action:
    service: lock.unlock
    entity_id: lock.front_door
    
    
- id: 'Unlock when cella get home'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: sensor.cella_home
    to: 'True'
  action:
    service: lock.unlock
    entity_id: lock.front_door
    
    
- id: 'Lock up when Cella leave'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: sensor.cella_home
    to: 'False'
  action:
    service: lock.lock
    entity_id: lock.front_door
    
    
- id: 'Lock up when Jor leave'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: sensor.jor_home
    to: 'False'
  action:
    service: lock.lock
    entity_id: lock.front_door
    
    
#TURN ON VDAY LIGHTS when CELLA ARRIVE HOME
#- id: CELLA_Arrive_HOME_TURNONVDAY
#  trigger:
#    platform: state
#    entity_id: sensor.cella_home
#    to: 'on'
#  action:
#    service: homeassistant.turn_on
#    entity_id:  

#TEST - Turn on AWAY MODE
- id: Lights_Out
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: sensor.everyone_home
    to: 'False'
  action:
    service: homeassistant.turn_off
    entity_id: group.everything
    
#Turn OFF office lights after no motion Cella WFH minutes

- id: Office_NoMotion_TurnOff_WFH
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_7_motion
    to: 'off'
    for: '00:20:00'
  condition:
    - condition: time
      weekday:
        - mon
        - wed
  action:
    service: homeassistant.turn_off
    entity_id: group.office
    
- id: Office_NoMotion_TurnOff_NormalDay
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_7_motion
    to: 'off'
    for: '00:05:00'
  condition:
    - condition: time
      weekday: 
        - tue
        - thu
        - fri
        - sat
        - sun
  action:
    service: homeassistant.turn_off
    entity_id: group.office

- id: 'Motion Office - Turn on Lights Day Time'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_7_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '06:00:10'
      before: '23:59:59'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id:
        - light.cellas_desk
        - light.office_top
      data:
        brightness: 254
        
- id: 'Motion Office - Turn on Lights Night Time'
  initial_state: 'on'
  trigger:
    - platform: state
      entity_id: 
      - binary_sensor.motion_sensor_7_motion
      to: 'on'
      from: 'off'
  condition:
    - condition: time
      after: '00:00:05'
      before: '06:00:05'
    - condition: state
      entity_id: 'sensor.everyone_home'
      state: 'True'
  action:
    - service: light.turn_on
      entity_id:
        - light.cellas_desk
        - light.office_top
      data:
        brightness: 45

- id: 'Push Travel Time From Jor to Cella'
  initial_state: on
  trigger:
    - platform: time
      minutes: '/5'
      seconds: '0'
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: '{{ is_state("input_boolean.push_notification_distance_jor_to_cella", "on") }}'
      - condition: numeric_state
        entity_id: sensor.google_travel_time_jor_to_cella
        above: 1
  action:
    - service: notify.notify
      data:
        title: "Jordan is {{states.sensor.google_travel_time_jor_to_cella.state}} minutes away"
        message: "Approximate ETA based on current traffic conditions and last known location"
        data:
          push:
            badge: 1
            category: camera
            entity_id: camera.street_view_jor_gps

- id: 'Push Travel Time From Cella to Jor'
  initial_state: on
  trigger:
    - platform: time
      minutes: '/5'
      seconds: '0'
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: '{{ is_state("input_boolean.push_notification_distance_cella_to_jor", "on") }}'
      - condition: numeric_state
        entity_id: sensor.google_travel_time_cella_to_jor
        above: 1
  action:
    - service: notify.notify
      data:
        title: "Cella is {{states.sensor.google_travel_time_cella_to_jor.state}} minutes away"
        message: "Approximate ETA based on current traffic conditions and last known location"
        data:
          push:
            badge: 1
            category: camera
            entity_id: camera.street_view_cella_gps

- id: 'Jor Has Arrived'
  initial_state: on
  trigger:
    - platform: numeric_state
      entity_id: sensor.google_travel_time_jor_to_cella
      below: 2
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: '{{ is_state("input_boolean.push_notification_distance_jor_to_cella", "on") }}'
  action:
    - service: notify.all_cella
      data:
        title: "Jordan has arrived!"
        message: "Jordan is here."
        data:
          push:
            badge: 1
            category: camera
            entity_id: camera.street_view_jor_gps
    - service: input_boolean.turn_off
      entity_id: input_boolean.push_notification_distance_jor_to_cella

- id: 'Cella Has Arrived'
  initial_state: on
  trigger:
    - platform: numeric_state
      entity_id: sensor.google_travel_time_cella_to_jor
      below: 2
  condition:
    condition: and
    conditions:
      - condition: template
        value_template: '{{ is_state("input_boolean.push_notification_distance_cella_to_jor", "on") }}'
  action:
    - service: notify.notify
      data:
        title: "Cella has arrived"
        message: "Cella is here."
        data:
          push:
            badge: 1
            category: camera
            entity_id: camera.street_view_cella_gps
    - service: input_boolean.turn_off
      entity_id: input_boolean.push_notification_distance_cella_to_jor
      
###Turn on AC when Humidity above 60%
#- id: Turn Living Room Air conditioner Upon High Humidity
#   value_template: >-
 #       {% if states.sensor.main_floor_humidity %}
  #          {% if states.sensor.main_floor_humidity.state | int > 40 %}
   #           true
    #        {% endif %}
     #   {% endif %}
  #action:
  #- service: climate.set_temperature
  #  data:
  #    entity_id: climate.air_conditioner
# # - delay: '00:15:00'
  #- service: climate.set_temperature
  #  data:
  #    entity_id: climate.air_conditioner
  #    temperature: 68
  #    operation_mode: Cool
  #    fan_mode: 'On High'
      
      
      
- id: "2345566435"
  initial_state: on
  trigger: 
    - platform: state
      entity_id: remote.harmonyhub2
      to: 'on'
      for: '01:30:00'
  action: 
    - service: remote.turn_off
      entity_id: remote.harmonyhub2
      data:
        activity: "34237743"
        
- id: "Turn off Bedroom Lights at Night"
  initial_state: on
  trigger: 
    - platform: state
      entity_id: remote.harmonyhub2
      to: 'on'
      for: '00:45:00'
  action: 
    - service: homeassistant.turn_off
      entity_id: group.master_bedroom
